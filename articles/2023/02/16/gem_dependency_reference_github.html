<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>Ruby Gem が依存している Gem の参照先をプライベートリポジトリなどに変更したい場合</title>

    <meta name="description" content="windyakin&#39;s profile and portfolio site." />

    <meta property="og:title" content="Ruby Gem が依存している Gem の参照先をプライベートリポジトリなどに変更したい場合" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://windyakin.net/articles/2023/02/16/gem_dependency_reference_github.html" />
    <meta property="og:image" content="https://windyakin.net/img/ogp.png" />
    <meta property="og:description" content="windyakin&#39;s profile and portfolio site." />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@MITLicense" />
    <meta name="twitter:creator" content="@MITLicense" />
    <meta name="twitter:title" content="Ruby Gem が依存している Gem の参照先をプライベートリポジトリなどに変更したい場合" />
    <meta name="twitter:image" content="https://windyakin.net/img/ogp.png" />
    <meta name="twitter:description" content="windyakin&#39;s profile and portfolio site." />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap-grid.min.css" integrity="sha512-JQksK36WdRekVrvdxNyV3B0Q1huqbTkIQNbz1dlcFVgNynEMRl0F8OSqOGdVppLUDIvsOejhr/W5L3G/b3J+8w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-ghcolors.min.css" integrity="sha512-8IZwRS36BrHutOtXP+S9ZLe/5MubhjJ26t1Kf9RYRt2kQi7brb8mLAKuJDX3qPJZ2U4Wg1cLPigCQVAxscTjtA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
      *,::after,::before{box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";line-height:1.5}article h1,article h2,article h3,article h4,article h5{line-height:1.2}ul{padding-left:1.2em;margin-top:.3em;padding-bottom:.3em}ul li{margin-top:.15em;margin-bottom:.15em}header{text-align:center;margin:0;padding:5rem 0}header>h1>a{text-decoration:none;color:#000}.content{padding:.5rem 0}.profile{text-align:center;font-size:14px;line-height:1.2}.profile-image{position:relative;width:160px;height:160px;margin:auto;border-radius:50%;overflow:hidden}.profile-image>img{width:160px;height:160px}.profile section{margin-bottom:2rem}.profile dl>div{margin-bottom:.8rem}.profile dl dt{margin-bottom:.2rem;font-size:.95rem}.profile dl dd{margin:0}.profile ul{list-style:none;margin:0;padding:0}.profile ul.inline-list>li{display:inline-block}.profile ul.inline-list>li:not(:last-child)::after{content:'/';margin:auto .2rem}footer{margin:0;padding:2rem 0;text-align:center}
      .articles{list-style:none;padding:0}.articles .articles-item{margin-top:1.5rem;margin-bottom:.5}.article-header{display:inline-flex}.article-header>time{margin-right:.8rem}ul.tags{display:inline-flex;margin:0;padding:0;list-style:none}ul.tags>li{display:inline-block;margin:0}.tags .tags-item{display:inline-block;margin:0;padding:0 .5rem 0 0;font-size:.85em}.tags .tags-item::before{content:'#'}.article-title{margin-top:.5rem;line-height:1.2}.more{margin:2rem auto 1rem auto}.more ul{list-style:none;padding:0}.pagination{margin:2rem auto 1rem auto}.pagination-list{list-style:none;padding:0}.pagination-list-item{padding:.5rem}a.anchor-link{color:#888;text-decoration:none}article code{font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace!important;font-size:85%!important}article code:not([class*=language-]){padding:.2em .4em;margin:0;white-space:break-spaces;background-color:rgba(175,184,193,.2);border-radius:6px}.responsive-img{max-width:100%;height:auto}
    </style>
  </head>
  <body>
    <header>
      <h1><a href="/">windyakin.net</a></h1>
    </header>

    <div class="content">
      <div class="container">
  <div class="row justify-content-lg-center">
    <main class="col-12 col-lg-8 col-xl-6 order-lg-last">
      <article class="article-body">
        <div class="article-header">
          <time datetime="2023-02-16">2023-02-16</time>
          <ul class="tags" aria-hidden="true">
            
            <li>
              
              <a href="/tags/Tips.html" class="tags-item">Tips</a>
            </li>
            
          </ul>
        </div>
        <h2 class="article-title">Ruby Gem が依存している Gem の参照先をプライベートリポジトリなどに変更したい場合</h2>
        <h3 id="ruby-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BE%9D%E5%AD%98%E5%85%88%E3%81%AE%E5%8F%82%E7%85%A7%E6%8C%87%E5%AE%9A" tabindex="-1"><a class="anchor-link" href="#ruby-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BE%9D%E5%AD%98%E5%85%88%E3%81%AE%E5%8F%82%E7%85%A7%E6%8C%87%E5%AE%9A" aria-hidden="true">#</a> Ruby アプリケーションの依存先の参照指定</h3>
<p>Ruby のアプリケーションだと、依存するライブラリ(Gem) を Gemfile に書くことが多いが、その際に <a href="https://rubygems.org">RubyGems.org</a> ではなく、 GitHub の特定のブランチなどを指定してインストールする構文がある。</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token comment"># application/Gemfile</span>
gem <span class="token string-literal"><span class="token string">'awesome_fluent_logger'</span></span><span class="token punctuation">,</span> <span class="token symbol">github</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'windyakin/awesome_fluent_logger'</span></span><span class="token punctuation">,</span> <span class="token symbol">branch</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'specific_branch'</span></span></code></pre>
<p>こうすることで、プライベートリポジトリを参照させたり、 Fork して独自の対応をしたコードなどを読み込ませて、アプリケーションを稼働させることが可能になる。</p>
<h3 id="%E3%81%A7%E3%81%AF-gem-%E8%87%AA%E8%BA%AB%E3%81%AE%E4%BE%9D%E5%AD%98%E3%81%AF%E3%81%A9%E3%81%86%E8%A1%A8%E7%8F%BE%E3%81%95%E3%82%8C%E3%82%8B%E3%81%8B" tabindex="-1"><a class="anchor-link" href="#%E3%81%A7%E3%81%AF-gem-%E8%87%AA%E8%BA%AB%E3%81%AE%E4%BE%9D%E5%AD%98%E3%81%AF%E3%81%A9%E3%81%86%E8%A1%A8%E7%8F%BE%E3%81%95%E3%82%8C%E3%82%8B%E3%81%8B" aria-hidden="true">#</a> では Gem 自身の依存はどう表現されるか</h3>
<p>一方で、参照される Gem 側にも依存する Gem が存在する。そういった情報は gemspec というファイルに書くことになっている。</p>
<p><code>Gem::Specification#add_dependencies</code> は依存する Gem のバージョンを細かく指定できるが、 Gemfile のように「GitHub のリポジトリなどを指定する」といった情報は書くことができない。</p>
<p>ではこのとき、どうするかというと、 Gem 側にも Gemfile が存在するので、そこにアプリケーションと同じ構文で指定することによって、読み込み先を変更することができる。</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token comment"># example/example.gemspec</span>
spec<span class="token punctuation">.</span>add_dependency <span class="token string-literal"><span class="token string">'fluent-logger'</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'~> 0.9'</span></span></code></pre>
<pre class="language-ruby"><code class="language-ruby"><span class="token comment"># example/Gemfile</span>
source <span class="token string-literal"><span class="token string">"https://rubygems.org"</span></span>

gemspec

gem <span class="token string-literal"><span class="token string">'fluent-logger'</span></span><span class="token punctuation">,</span> <span class="token symbol">github</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'windyakin/fluent-logger'</span></span><span class="token punctuation">,</span> <span class="token symbol">branch</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'specific_branch'</span></span></code></pre>
<p>この状態で、 Gem の開発環境上で <code>bundle install</code> などを実行すれば、 Git リポジトリから落としてきたコードを利用することができるようになる。</p>
<h3 id="%E5%8F%82%E7%85%A7%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E4%B8%8A%E3%81%A7%E3%81%AF%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%E3%81%AE%E3%81%8B" tabindex="-1"><a class="anchor-link" href="#%E5%8F%82%E7%85%A7%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E4%B8%8A%E3%81%A7%E3%81%AF%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%E3%81%AE%E3%81%8B" aria-hidden="true">#</a> 参照しているアプリケーション上ではどうなるのか</h3>
<p>一方、この指定は Gem として読び出しているアプリケーション側に継承されることはなく、 <code>bundle install</code> をしても <a href="http://RubyGems.org">RubyGems.org</a> から該当する名前の Gem とバージョンを参照してくるようになっている。</p>
<p>わかりにくいので、下記のような関係の場合において考えてほしい。</p>
<pre class="language-plain"><code class="language-plain">Application (A) -> Example Gem (B) -> Dependency Gem (C)</code></pre>
<p>例えば Example Gem (B) が依存する Dependency Gem (C) の参照先を GitHub に向けたいとする。</p>
<p>このとき、 Example Gem (B) の Gemfile に Dependency Gem (C) の参照先として GitHub を記述しても、 Application (A) はその情報を読み取ることはなく、 <a href="http://RubyGems.org">RubyGems.org</a> にある Dependency Gem (C) を参照するようになっている。</p>
<p>もし、 Dependency Gem (C) の参照先を GitHub に変更したい場合は、 Application (A) 側の Gemfile 上で Dependency Gem (C) の参照先を記述するとよい。アプリケーション側で直接利用していなくても、こうすることで解決することができる。</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token comment"># application/Gemfile</span>
gem <span class="token string-literal"><span class="token string">'awesome_fluent_logger'</span></span>
gem <span class="token string-literal"><span class="token string">'fluent-logger'</span></span><span class="token punctuation">,</span> <span class="token symbol">github</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'windyakin/fluent-logger'</span></span><span class="token punctuation">,</span> <span class="token symbol">branch</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'specific_branch'</span></span></code></pre>
<h3 id="%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E6%83%85%E5%A0%B1" tabindex="-1"><a class="anchor-link" href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E6%83%85%E5%A0%B1" aria-hidden="true">#</a> 参考にした情報</h3>
<ul>
<li><a href="https://docs.ruby-lang.org/ja/latest/method/Gem=3a=3aSpecification/i/add_dependency.html">Gem::Specification#add_dependency (Ruby 3.2 リファレンスマニュアル)</a></li>
<li><a href="https://blog.takeyuweb.co.jp/entry/2014/10/16/163113">gemspecの依存先にGitHubのプライベートリポジトリを指定する - タケユー・ウェブ日報</a></li>
</ul>

      </article>
    </main>
    <aside class="col-12 col-lg-4 col-xl-3 order-lg-first mt-5 mt-lg-0">
      <div class="profile">
  <div class="profile-image">
    <img src="/img/profile.jpg" alt="windyakin" />
  </div>

  <section>
    <h2>Profile</h2>
    <dl>
      <div>
        <dt>Name</dt>
        <dd>
          <ul class="inline-list">
            <li lang="en">KANZAKI Takuto</li><li lang="ja">神﨑 拓人</li>
          </ul>
        </dd>
      </div>
      <div>
        <dt>Screen name</dt>
        <dd>
          <ul class="inline-list">
            <li>windyakin</li><li>じゅりあん</li>
          </ul>
        </dd>
      </div>
    </dl>

    <div>
      <a href="/carrier/"</a>職務経歴書</a>
    </div>
  </section>

  <section>
    <h2>Organization</h2>
    <dl>
      <div>
        <dt><a href="https://pepabo.com">GMO Pepabo, Inc.</a></dt>
        <dd>Senior Engineer</dd>
      </div>
      <div>
        <dt><a href="https://umineco.org/">沼津移住者コミュニティ<br/>うみねこ</a></dt>
        <dd>Organizer</dd>
      </div>
      <div>
        <dt><a href="https://napple.team/">Napple Team</a></dt>
        <dd>Organizer</dd>
      </div>
    </dl>
  </section>

  <section>
    <h2>Contact / Link</h2>
    <dl>
      <div>
        <dt>E-mail</dt>
        <dd><a href="mailto:windyakin@napple.team">windyakin@napple.team</a></dd>
      </div>
      <div>
        <dt>Twitter</dt>
        <dd><a href="https://twitter.com/MITLicense">twitter.com/MITLicense</a></dd>
      </div>
      <div>
        <dt>Bluesky</dt>
        <dd><a href="https://bsky.app/profile/windyakin.net">bsky.app/profile/@windyakin.net</a></dd>
      </div>
      <div>
        <dt>GitHub</dt>
        <dd><a href="https://github.com/windyakin">github.com/windyakin</a></dd>
      </div>
      <div>
        <dt>Facebook</dt>
        <dd><a href="https://www.facebook.com/windyakin">facebook.com/windyakin</a></dd>
      </div>
      <div>
        <dt>Vimeo</dt>
        <dd><a href="https://vimeo.com/windyakin">vimeo.com/windyakin</a></dd>
      </div>
    </dl>
  </section>
</div>

    </aside>
  </div>
</div>

    </div>

    <footer>
      © 2020 windyakin
    </footer>
  </body>
</html>
