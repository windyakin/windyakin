<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>Nuxt2でコンポーネントから今表示しているページのタイトル要素を取りたいとき</title>

    <meta name="description" content="windyakin&#39;s profile and portfolio site." />

    <meta property="og:title" content="Nuxt2でコンポーネントから今表示しているページのタイトル要素を取りたいとき" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://windyakin.net/articles/2021/09/29/get-the-page-title-from-nuxt2-component.html" />
    <meta property="og:image" content="https://windyakin.net/img/ogp.png" />
    <meta property="og:description" content="windyakin&#39;s profile and portfolio site." />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@MITLicense" />
    <meta name="twitter:creator" content="@MITLicense" />
    <meta name="twitter:title" content="Nuxt2でコンポーネントから今表示しているページのタイトル要素を取りたいとき" />
    <meta name="twitter:image" content="https://windyakin.net/img/ogp.png" />
    <meta name="twitter:description" content="windyakin&#39;s profile and portfolio site." />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap-grid.min.css" integrity="sha512-JQksK36WdRekVrvdxNyV3B0Q1huqbTkIQNbz1dlcFVgNynEMRl0F8OSqOGdVppLUDIvsOejhr/W5L3G/b3J+8w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-ghcolors.min.css" integrity="sha512-8IZwRS36BrHutOtXP+S9ZLe/5MubhjJ26t1Kf9RYRt2kQi7brb8mLAKuJDX3qPJZ2U4Wg1cLPigCQVAxscTjtA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-sans-all@0.1.3/css/open-sans.min.css" integrity="sha256-wgnFwa6HsOY7SkI0IyMuzVeCe1qXdWyFp97C9tknq/U=" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
      *,::after,::before{box-sizing:border-box}body{font-family:"Open Sans","Helvetica Neue",Helvetica,Arial,"Hiragino Kaku Gothic ProN","メイリオ",Meiryo,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}header{text-align:center;margin:5rem auto}header>h1>a{text-decoration:none;color:#000}.profile{text-align:center;font-size:14px}.profile-image{position:relative;width:160px;height:160px;margin:auto;border-radius:50%;overflow:hidden}.profile-image>img{width:160px;height:160px}.profile section{margin-bottom:2rem}.profile dl>div{margin-bottom:.8rem}.profile dl dt{margin-bottom:.2rem;font-size:.95rem}.profile dl dd{margin:0}.profile ul{list-style:none;padding:0}.profile ul>li{margin-bottom:.2rem}.profile ul.inline-list>li{display:inline-block}.profile ul.inline-list>li:not(:last-child)::after{content:'/';margin:auto .2rem}footer{margin:2rem auto;text-align:center}
      .articles{list-style:none;padding:0}.atom{font-size:.7em;font-weight:400}.articles .articles-item{margin-top:1.5rem}.article-header{display:inline-flex;margin-top:.5rem;margin-bottom:0}.article-header>time{margin-right:.8rem}ul.tags{display:inline-flex;margin:0;padding:0;list-style:none}ul.tags>li{display:inline-block;margin:0}.tags .tags-item{display:inline-block;margin:0;padding:0 .5rem 0 0;font-size:.85em}.tags .tags-item::before{content:'#'}.articles .articles-item>h3{margin-top:.5rem}article p{line-height:1.4rem}article ul{padding-left:1.3em}article ul li{margin-top:.3rem}a.anchor-link{color:#888;text-decoration:none}code[class*=language-],pre[class*=language-]{font-family:monospace}.responsive-img{max-width:100%;height:auto}
    </style>
  </head>
  <body>
    <header>
      <h1><a href="/">windyakin.net</a></h1>
    </header>

    <div class="container">
  <div class="row justify-content-lg-center">
    <main class="col-12 col-lg-8 col-xl-6 order-lg-last">
      <article>
        <div class="article-header">
          <time datetime="2021-09-29">2021-09-29</time>
          <ul class="tags" aria-hidden="true">
            
            <li>
              
              <a href="/tags/Tips.html" class="tags-item">Tips</a>
            </li>
            
          </ul>
        </div>
        <h2 class="article-title">Nuxt2でコンポーネントから今表示しているページのタイトル要素を取りたいとき</h2>
        <p>Nuxt2 でコンポーネントから今表示しているページのタイトル要素を取りたいケースがある。</p>
<p>具体的に言うと Twitter のツイートボタンを自前で実装するときに使えるリンク形式でツイートを発行できる機能があり、このツイートするテキスト部分ににページのタイトルを含めたかった。</p>
<pre class="language-text"><code class="language-text">https://twitter.com/intent/tweet?url=[ツイートしたいURL]&text=[タイトルを含むテキスト]</code></pre>
<p>このとき、 Nuxt のコンポーネント側からタイトルを知る方法として一番最初に思いつくのは <code>document.title</code> という JavaScript の古典的な API である。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">pageTitle</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>pageTitle <span class="token operator">=</span> document<span class="token punctuation">.</span>title<br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>これは確かに最初に表示したページやコンポーネントがロードされたタイミングのページのタイトルを取得することはできるが、 Nuxt 内に <code>&lt;nuxt-link&gt;</code> のを含んでいて、遷移の際にコンポーネントがそのまま表示され続けるような場合は値の変更がされない。考えてみれば「それはそう」だし。単純に自分の想定があまい。</p>
<p>じゃあページ変更をトリガーすれば良いんだろうということで、 <code>$route</code> を <code>watch</code> によって監視することでページ遷移のタイミングで <code>document.title</code> を取得し直せばよいのだろうということでこういうコードを書いた。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">pageTitle</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>pageTitle <span class="token operator">=</span> document<span class="token punctuation">.</span>title<br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function">$route</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>pageTitle <span class="token operator">=</span> document<span class="token punctuation">.</span>title<br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>しかしこれもうまく行かなかった。たしかに <code>watch.$route</code> はページ遷移のときに通っていくのだが、このタイミングで <code>document.title</code> を叩いても返ってくるのは遷移前のページのタイトルなのである。つまり <code>document.title</code> が変更される前にここを通っているため、ページ遷移をすると1ページ前に見ていたタイトルしか取得できないように見える。</p>
<p>最終的に StackOverflow でこういう記事を見つけた。</p>
<p><a href="https://stackoverflow.com/questions/57287500/add-a-watcher-to-document-title-in-nuxt-js">javascript - Add a watcher to document.title in Nuxt.Js - Stack Overflow</a></p>
<p>記事内のコードに書いてあるとおりで、HTML DOM を監視する JavaScript API である <code>MutationObserver</code> を使って <code>&lt;title&gt;</code> タグを監視して更新するといったもの。</p>
<p>書いてみるとまあ確かに動く（単純に Mutation Observer を使っているだけなので）。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">pageTitle</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>pageTitle <span class="token operator">=</span> document<span class="token punctuation">.</span>title<br>    <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>pageTitle <span class="token operator">=</span> document<span class="token punctuation">.</span>title<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>動いたのはいいが、なんだかもやもやするコードである。本当は上位から表示しているページのタイトルの内容を通知するといいのだろうが、 layout に埋め込まれているコンポーネントの場合、そのデータのやりとりが若干ややこしくなってしまう。正直ページタイトルを取得するためにそこまでやりたくはないし、こういうユースケースはよくありそうなので、できれば Nuxt 側で取れるようになってほしいなと思った。</p>

      </article>
    </main>
    <aside class="col-12 col-lg-4 col-xl-3 order-lg-first mt-5 mt-lg-0">
      <div class="profile">
  <div class="profile-image">
    <img src="/img/profile.jpg" alt="windyakin" />
  </div>

  <section>
    <h2>Profile</h2>
    <dl>
      <div>
        <dt>Name</dt>
        <dd>
          <ul class="inline-list">
            <li lang="en">KANZAKI Takuto</li><li lang="ja">神﨑 拓人</li>
          </ul>
        </dd>
      </div>
      <div>
        <dt>Screen name</dt>
        <dd>
          <ul class="inline-list">
            <li>windyakin</li><li>じゅりあん</li>
          </ul>
        </dd>
      </div>
    </dl>
  </section>

  <section>
    <h2>Organization</h2>
    <dl>
      <div>
        <dt><a href="https://pepabo.com">GMO Pepabo, Inc.</a></dt>
        <dd>Senior Engineer</dd>
      </div>
      <div>
        <dt><a href="https://napple.team/">Napple Team</a></dt>
        <dd>Organizer</dd>
      </div>
    </dl>
  </section>

  <section>
    <h2>Contact / Link</h2>
    <dl>
      <div>
        <dt>E-mail</dt>
        <dd><a href="mailto:windyakin@napple.team">windyakin@napple.team</a></dd>
      </div>
      <div>
        <dt>Twitter</dt>
        <dd><a href="https://twitter.com/MITLicense">twitter.com/MITLicense</a></dd>
      </div>
      <div>
        <dt>GitHub</dt>
        <dd><a href="https://github.com/windyakin">github.com/windyakin</a></dd>
      </div>
      <div>
        <dt>Tumblr</dt>
        <dd><a href="https://windyakin.tumblr.com/">windyakin.tumblr.com</a></dd>
      </div>
      <div>
        <dt>Facebook</dt>
        <dd><a href="https://www.facebook.com/windyakin">facebook.com/windyakin</a></dd>
      </div>
      <div>
        <dt>Vimeo</dt>
        <dd><a href="https://vimeo.com/windyakin">vimeo.com/windyakin</a></dd>
      </div>
    </dl>
  </section>
</div>

    </aside>
  </div>
</div>


    <footer>
      © 2020 windyakin
    </footer>
  </body>
</html>
