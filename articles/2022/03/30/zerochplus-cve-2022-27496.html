<!doctype html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>10年前に公開していたCGIプログラムで脆弱性が見つかりCVEに登録された話</title><meta name="description" content="windyakin&#39;s profile and portfolio site."><meta property="og:title" content="10年前に公開していたCGIプログラムで脆弱性が見つかりCVEに登録された話"><meta property="og:type" content="website"><meta property="og:url" content="https://windyakin.net/articles/2022/03/30/zerochplus-cve-2022-27496.html"><meta property="og:image" content="https://windyakin.net/img/ogp.png"><meta property="og:description" content="windyakin&#39;s profile and portfolio site."><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@MITLicense"><meta name="twitter:creator" content="@MITLicense"><meta name="twitter:title" content="10年前に公開していたCGIプログラムで脆弱性が見つかりCVEに登録された話"><meta name="twitter:image" content="https://windyakin.net/img/ogp.png"><meta name="twitter:description" content="windyakin&#39;s profile and portfolio site."><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap-grid.min.css" integrity="sha512-JQksK36WdRekVrvdxNyV3B0Q1huqbTkIQNbz1dlcFVgNynEMRl0F8OSqOGdVppLUDIvsOejhr/W5L3G/b3J+8w==" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-ghcolors.min.css" integrity="sha512-8IZwRS36BrHutOtXP+S9ZLe/5MubhjJ26t1Kf9RYRt2kQi7brb8mLAKuJDX3qPJZ2U4Wg1cLPigCQVAxscTjtA==" crossorigin="anonymous" referrerpolicy="no-referrer"><style>*,::after,::before{box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";line-height:1.5}article h1,article h2,article h3,article h4,article h5{line-height:1.2}ul{padding-left:1.2em;margin-top:.3em;padding-bottom:.3em}ul li{margin-top:.15em;margin-bottom:.15em}header{text-align:center;margin:0;padding:5rem 0}header>h1>a{text-decoration:none;color:#000}.content{padding:.5rem 0}.profile{text-align:center;font-size:14px;line-height:1.2}.profile-image{position:relative;width:160px;height:160px;margin:auto;border-radius:50%;overflow:hidden}.profile-image>img{width:160px;height:160px}.profile section{margin-bottom:2rem}.profile dl>div{margin-bottom:.8rem}.profile dl dt{margin-bottom:.2rem;font-size:.95rem}.profile dl dd{margin:0}.profile ul{list-style:none;margin:0;padding:0}.profile ul.inline-list>li{display:inline-block}.profile ul.inline-list>li:not(:last-child)::after{content:'/';margin:auto .2rem}footer{margin:0;padding:2rem 0;text-align:center}
      .articles{list-style:none;padding:0}.articles .articles-item{margin-top:1.5rem;margin-bottom:.5}.article-header{display:inline-flex}.article-header>time{margin-right:.8rem}ul.tags{display:inline-flex;margin:0;padding:0;list-style:none}ul.tags>li{display:inline-block;margin:0}.tags .tags-item{display:inline-block;margin:0;padding:0 .5rem 0 0;font-size:.85em}.tags a.tags-item::before{content:'#'}.article-title{margin-top:.5rem;line-height:1.2}.more{margin:2rem auto 1rem auto}.more ul{list-style:none;padding:0}.pagination{margin:2rem auto 1rem auto}.pagination-list{list-style:none;padding:0}.pagination-list-item{padding:.5rem}a.anchor-link{color:#888;text-decoration:none}article code{font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace!important;font-size:85%!important}article code:not([class*=language-]){padding:.2em .4em;margin:0;white-space:break-spaces;background-color:rgba(175,184,193,.2);border-radius:6px}article blockquote{margin:1.5rem 0;padding-left:1.5rem;border-left:4px solid #ccc}article blockquote p{margin:0}.responsive-img{max-width:100%;height:auto}</style></head><body><header><h1><a href="/">windyakin.net</a></h1></header><div class="content"><div class="container"><div class="row justify-content-lg-center"><main class="col-12 col-lg-8 col-xl-6 order-lg-last"><article class="article-body"><div class="article-header"><time datetime="2022-03-30">2022-03-30</time><ul class="tags" aria-hidden="true"><li><a href="/tags/ぜろちゃんねるプラス.html" class="tags-item">ぜろちゃんねるプラス</a></li></ul></div><h2 class="article-title">10年前に公開していたCGIプログラムで脆弱性が見つかりCVEに登録された話</h2><p>かつて「ぜろちゃんねるプラス」という２ちゃんねる型スレッドフロート掲示板システムの開発と公開をしていたことがある。</p><p><a href="http://zerochplus.osdn.jp/">ぜろちゃんねるプラス</a></p><p>とはいえ開発をしていたというのは自身がまだ学生だった10年以上前の話であり、現代において Perl CGI のプログラムを保守・運用しようというのがなかなか厳しい話なので、ウェブサイト上では2015年ぐらいから開発の終了も明言していた。ただホスティング元のOSDN(当時はSourceForge.jpであった)が現在までサービスの提供を続けてくれていることと、すでに利用している人に向けたアーカイブを目的として、特に非公開化することもしていなかった結果、現代でも一部のコミュニティなどで使われるという謎の代物となっていた。</p><h3 id="%E9%96%8B%E7%99%BA%E8%80%85%E3%81%B8%E3%81%AE%E8%84%86%E5%BC%B1%E6%80%A7%E3%81%AE%E5%A0%B1%E5%91%8A" tabindex="-1"><a class="anchor-link" href="#%E9%96%8B%E7%99%BA%E8%80%85%E3%81%B8%E3%81%AE%E8%84%86%E5%BC%B1%E6%80%A7%E3%81%AE%E5%A0%B1%E5%91%8A" aria-hidden="true">#</a> 開発者への脆弱性の報告</h3><p>そんなこんなで絶賛放置していたのだが、3月22日の10時頃、開発用の掲示板に「クロスサイトスクリプティングが行える脆弱性」があるという内容の報告がもたらされた。自分はその掲示板を常に見ていないのだが、開発メンバーの1人がそれに気づいて同日の22時ごろに Twitter の DM 経由にて自分を含む当時の開発メンバーに通知された。調べると連絡が来るより数日前からすでにこの攻撃は一部で横行しているようで、このスクリプトを使っているサイトの運営者はなんらかの対応を行う必要がある状態となっていた。</p><p>しかし先述の通り、そもそも開発の終了を宣言しているプロジェクトである。開発元からの対応はしないならしないでもよいとも考えられるのだが、職業をエンジニアとしている者としては、一度出したものに「脆弱性がある」という状態のまま放置するのも居心地がわるいので、今回は特別に該当箇所のホットフィックス版をリリースをすることとした。</p><h3 id="%E4%BF%AE%E6%AD%A3%E3%81%BE%E3%81%A7%E3%81%AE%E9%81%8E%E7%A8%8B" tabindex="-1"><a class="anchor-link" href="#%E4%BF%AE%E6%AD%A3%E3%81%BE%E3%81%A7%E3%81%AE%E9%81%8E%E7%A8%8B" aria-hidden="true">#</a> 修正までの過程</h3><p>まずは報告を受けた内容の真偽を確かめつつ原因の調査をする必要があるのだが、そのためにはサンドボックス環境を用意する必要がある。脆弱性への対応であることや、すでに攻撃が発生していることから、インターネット環境で試すことはあまり好ましいことではない。できればローカル環境で実験したいのだが、当時開発に使っていたXAMPPなんてとうに捨てており、また現代において Perl CGI が動く環境を用意するのはそこらへんの Rails を動かすより手間であるかもしれない。</p><p>ただこの問題については、数年前に気まぐれでプロジェクトを Docker イメージ化をしていたので割とすぐ用意することに成功した。数年前の自分の気まぐれはなかなかのファインプレーであった。</p><p><a href="https://github.com/zerochplus/zerochplus-docker">zerochplus/zerochplus-docker: 🐳 zerochplus on Docker</a></p><p>またぜろちゃんねるプラスのリポジトリは SVN である。一応 GitHub にもプロジェクトの Organization とミラーリポジトリっぽいものがあるのだが、実は SVN とは履歴も状態が乖離している。我ながらひどい状態で放置していたものである。結局数年ぶりに SVN コマンドを叩くことになった。</p><p>ただ脆弱性の起因となるコード箇所の特定は比較的スムーズに行うことができた。これは当時の開発メンバーへの連絡により比較的早い段階で人手を招集でき、それぞれが調査を行ったおかげである。こういった緊急事態の初動は人手が多いほうがよい。</p><p>その他にもリリースパッケージの作成などリリース作業で手こずる場面は多かったのだが、23日0時にホットフィックス版である ぜろちゃんねるプラス v0.7.5 をリリースをした。後から気になって調べたが、前回のリリースから約3,000日ぶりの更新であったらしい。今回開発者への初報を受けてから約14時間、開発者の招集からは3時間弱での対応となったが、3,000日ぶりのリリースにしてはかなりスピード感があるほうではないだろうか。</p><h3 id="ipa%E3%81%B8%E3%81%AE%E5%A0%B1%E5%91%8A" tabindex="-1"><a class="anchor-link" href="#ipa%E3%81%B8%E3%81%AE%E5%A0%B1%E5%91%8A" aria-hidden="true">#</a> IPAへの報告</h3><p>ぜろちゃんねるプラスには自動アップデートの機能は備え付けられておらず、サイトの運営者が自身で情報を取りに来なければ脆弱性が含まれていることを察知できない。そのため情報の発信していく必要があるのだが、ぜろちゃんねるプラスのサイト上では最大限告知をしたとて限度がある。そこでIPAへ今回の脆弱性を報告をすることで、JVNからの発信を行ってもらうことにした。これで万全というわけではないことは重々承知だが、使えるチャンネルはできる限り使ったほうがよいだろうという判断である。</p><p>報告後、何度かメールのやりとりを行ってレポートが作成された。すでに攻撃が発生しており修正版も出ている内容だったためか、JPCERTの方には素早い対応をしていただき、3月30日にJVN上で公表されている。</p><p><a href="https://jvn.jp/jp/JVN59576930/index.html">JVN#59576930: ぜろちゃんねるプラスにおけるクロスサイトスクリプティングの脆弱性</a></p><p>なお今回は CVE の番号 <a href="https://www.cve.org/CVERecord?id=CVE-2022-27496">CVE-2022-27496</a> も採番された。自身の関わったプロダクトに CVE が採番されるのはなかなか複雑な気持ちではあるが、経験値としては悪くないだろう。</p><h3 id="%E3%81%AA%E3%81%9C%E4%BB%8A%E5%9B%9E%E5%AF%BE%E5%BF%9C%E3%81%A7%E3%81%8D%E3%81%9F%E3%81%8B" tabindex="-1"><a class="anchor-link" href="#%E3%81%AA%E3%81%9C%E4%BB%8A%E5%9B%9E%E5%AF%BE%E5%BF%9C%E3%81%A7%E3%81%8D%E3%81%9F%E3%81%8B" aria-hidden="true">#</a> なぜ今回対応できたか</h3><p>冒頭にも書いたが今回そもそも対応するかどうかは判断が微妙なところだった。ほぼ義理と人情みたいなところで動いているのだが、一番大きかったのは会社でのインシデント対応によって培われた突発的な事象への対処能力かもしれない。正確には能力というよりかは気持ち的な問題で、いざコトが起きてしまったときに、ただ悲観的になって立ち止まったり放棄するのではなく、「よしやるか」とギアを入れ替えて問題に挑めるようになってきたような気がしている。</p><p>今回も報告を受けたときに比較的早い段階で「対応する」という方向に舵を切って対処し、忘れ去っていたリリース方法までがんばって思い出してリリースできたことは非常によい経験だったように思う。</p><h3 id="%E4%BB%8A%E5%BE%8C%E3%81%AE%E3%81%9C%E3%82%8D%E3%81%A1%E3%82%83%E3%82%93%E3%81%AD%E3%82%8B%E3%83%97%E3%83%A9%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" tabindex="-1"><a class="anchor-link" href="#%E4%BB%8A%E5%BE%8C%E3%81%AE%E3%81%9C%E3%82%8D%E3%81%A1%E3%82%83%E3%82%93%E3%81%AD%E3%82%8B%E3%83%97%E3%83%A9%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" aria-hidden="true">#</a> 今後のぜろちゃんねるプラスについて</h3><p>改めて言うが、今回のホットフィックス版のリリースは極めて異例の対応である。今後また同じような報告を受けた際に同じような対応ができるかについては明言を避けたい。これを機会にぜろちゃんねるプラスの利用者には「開発を終了しているもの」を使っているというリスクを理解し、適切な対処をしてほしいと思っている。</p><h3 id="%E5%BE%A9%E6%97%A7%E3%81%BE%E3%81%A7%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%A9%E3%82%A4%E3%83%B3" tabindex="-1"><a class="anchor-link" href="#%E5%BE%A9%E6%97%A7%E3%81%BE%E3%81%A7%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%A9%E3%82%A4%E3%83%B3" aria-hidden="true">#</a> 復旧までのタイムライン</h3><ul><li>2022年3月22日 10:00<ul><li>ぜろちゃんねるプラスの開発掲示板にクロスサイトスクリプティングに関する脆弱性の報告</li></ul></li><li>21:45<ul><li>報告を受け当時の開発メンバーが招集</li></ul></li><li>22:30<ul><li>ローカル環境にて報告内容の再現を確認</li></ul></li><li>23:00<ul><li>パッチコード作成完了</li><li>リリース向けのパッケージ化や準備を開始</li></ul></li><li>2022年3月23日 00:30<ul><li>ぜろちゃんねるプラス v0.7.5 リリース</li></ul></li><li>10:00<ul><li>IPA へ脆弱性関連情報の届出</li></ul></li><li>2022年3月30日 12:00<ul><li>JVN より脆弱性情報の公表</li></ul></li></ul><p>日付・時刻はすべて日本時間</p></article></main><aside class="col-12 col-lg-4 col-xl-3 order-lg-first mt-5 mt-lg-0"><div class="profile"><div class="profile-image"><img src="/img/profile.jpg" alt="windyakin"></div><section><h2>Profile</h2><dl><div><dt>Name</dt><dd><ul class="inline-list"><li lang="en">KANZAKI Takuto</li><li lang="ja">神﨑 拓人</li></ul></dd></div><div><dt>Screen name</dt><dd><ul class="inline-list"><li>windyakin</li><li>じゅりあん</li></ul></dd></div></dl><div><a href="/carrier/">職務経歴書</a></div></section><section><h2>Organization</h2><dl><div><dt><a href="https://pepabo.com">GMO Pepabo, Inc.</a></dt><dd>Senior Engineer</dd></div><div><dt><a href="https://umineco.org/">沼津移住者コミュニティ<br>うみねこ</a></dt><dd>Organizer</dd></div><div><dt><a href="https://napple.team/">Napple Team</a></dt><dd>Organizer</dd></div></dl></section><section><h2>Contact / Link</h2><dl><div><dt>E-mail</dt><dd><a href="mailto:windyakin@napple.team">windyakin@napple.team</a></dd></div><div><dt>Bluesky</dt><dd><a href="https://bsky.app/profile/windyakin.net">bsky.app/profile/@windyakin.net</a></dd></div><div><dt>GitHub</dt><dd><a href="https://github.com/windyakin">github.com/windyakin</a></dd></div><div><dt>Facebook</dt><dd><a href="https://www.facebook.com/windyakin">facebook.com/windyakin</a></dd></div><div><dt>Vimeo</dt><dd><a href="https://vimeo.com/windyakin">vimeo.com/windyakin</a></dd></div></dl></section></div></aside></div></div></div><footer>© 2020 windyakin</footer></body></html>